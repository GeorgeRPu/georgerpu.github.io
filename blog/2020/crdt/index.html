<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Conflict Free Replicated Data Types | George Pu</title> <meta name="author" content="George Pu"> <meta name="description" content="A survey of simple CRDTs and their future in computing"> <meta name="keywords" content="academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link href="/assets/css/bootstrap-toc.min.css?6f5af0bb9aab25d79b2448143cbeaa88" rel="stylesheet"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%A7%AE&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://georgerpu.github.io/blog/2020/crdt/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">George </span>Pu</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv</a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">teaching</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="row"> <div class="col-sm-3"> <nav id="toc-sidebar" class="sticky-top"></nav> </div> <div class="col-sm-9"> <div class="post"> <header class="post-header"> <h1 class="post-title">Conflict Free Replicated Data Types</h1> <p class="post-meta">July 20, 2020</p> <p class="post-tags"> <a href="/blog/2020"> <i class="fas fa-calendar fa-sm"></i> 2020 </a>   ·   <a href="/blog/tag/computer-science"> <i class="fas fa-hashtag fa-sm"></i> computer-science</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <h2 id="introduction">Introduction</h2> <p>Back in 2017, I used Atom as my primary text editor. It was pretty and customizable—some features like <a href="https://github.atom.io/" rel="external nofollow noopener" target="_blank">GitHub integration</a>, <a href="https://atom.io/packages/hydrogen" rel="external nofollow noopener" target="_blank">running Python code inline</a>, or <a href="https://github.blog/2018-10-31-atoms-new-parsing-system/" rel="external nofollow noopener" target="_blank">syntax tree based highlighting</a> still have no counterpart in other popular text editors—but very slow. It is an Electron<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup> app and not a particularly efficient one. A single Atom window would routinely consume 1GB or more of memory. So I was excited when I heard about <a href="https://github.com/atom-archive/xray" rel="external nofollow noopener" target="_blank">Xray</a>, a new project on GitHub by GitHub that might serve as a replacement for Atom. The codebase was primarily in Rust, giving it the speed and lightness Atom lacked. People on the <atom.io> forums thought it might become Atom 2.0.</atom.io></p> <p>Inside Xray, text is represented as a <strong>conflict-free replicated data type</strong> (CRDT). Each machine keeps its own version or <strong>replica</strong> of the data structure on which users make local changes. Differing replicas can then be merged in a consistent manner without relying a central coordinating server. There is no conflict having multiple differing replicas. Since merges may be performed with as few as 2 replicas, we can consider it a binary operation $+$, albeit one that is mostly used in place. For the merge operation to be invariant to operation order, $+$ should be associative and commutative (hence the use of additive notation).</p> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="https://github.com/atom-archive/xray/blob/master/docs/images/crdt?raw=trueg-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="https://github.com/atom-archive/xray/blob/master/docs/images/crdt?raw=trueg-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="https://github.com/atom-archive/xray/blob/master/docs/images/crdt?raw=trueg-1400.webp"></source> <img src="https://github.com/atom-archive/xray/blob/master/docs/images/crdt.png?raw=trueg" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p>Suppose we have $a, b, c$ replicas that should merge consistently in any order. That is, we want to be able to rearrange $(a + b) + c$ without changing the value of the expression. If $+$ is commutative, we can swap the replicas within the parentheses as is.</p> \[(a + b) + c = (b + a) + c \qquad\text{commutative property}\] <p>To swap across parentheses, we need to be about to shift the parentheses.</p> \[\begin{align*} (a + b) + c &amp;= a + (b + c) &amp;&amp;\text{associative property} \\ &amp;= a + (c + b) &amp;&amp;\text{commutative property} \\ &amp;= (a + c) + b &amp;&amp;\text{associative property} \end{align*}\] <p>With enough pairwise swaps, we can arbitrarily reorder this expression.</p> <p>After Microsoft’s purchase of GitHub, it now owned Atom along with the more popular and performant VSCode. Atom was redundant. Over the course of year, updates became smaller and less frequent. By mid-2019, posts on <a href="https://blog.atom.io/" rel="external nofollow noopener" target="_blank">https://blog.atom.io/</a> stopped. The Xray project was <a href="https://github.com/atom-archive/xray/pull/183" rel="external nofollow noopener" target="_blank">archived</a> on GitHub. Development effort was redirected to VSCode where it soon surpassed Atom in overall features. I switched to VSCode permanently in Fall 2019. While Xray/Atom 2.0 may have failed, CRDTs have just started to succeed, seeing usage in applications from <a href="https://crdt.tech/implementations" rel="external nofollow noopener" target="_blank">databases to chat messages to text editors</a>. Perhaps their greatest feature is equality; no replica is privileged over others. In a computing ecosystem that is all too centralized, CRDTs could help power the more distributed apps of the future.</p> <h2 id="basic-crdts">Basic CRDTs</h2> <h3 id="counters">Counters</h3> <p>The most basic CRDT is the <strong>grow only counter</strong> which can only be incremented. Suppose we have peers $1, \dots, n$ in a computer network. A grow only counter $A$ is a $n$-tuple where $A_i$ counts the number of increases by peer $i$. The value of the grow-only counter is the sum of all entries $A_1 + \dots + A_n$. Merges with another grow-only counter $B$ are performed by setting $A_i = \max(A_i, B_i)$ for each $1 \leq i \leq n$.</p> <p>Why do we need to track increments individually for each peer? Why couldn’t we use a single register whose value is the total number of increments? Suppose we have 3 counters $a, b, c$ connected over the Internet. Replica $a$ wants to merge with replicas $b$ and $c$, but replica $c$ has already merged with replica $b$. So replica $a$ effectively merges with replica $b$ two times, but this should have no effect on the final result.</p> \[a + b = a + b + b\] <p>Merges should be idempotent. The addition of integers is not idempotent. The $\max(\cdot, \cdot)$​​​ of integers is however; repeated elements do not change the maximum of a set.</p> \[\max(\max(a, b), b) = \max(a, b)\] <p>Since only peer $i$ can increment its entry in the grow-only counter, its replica will have the largest $i$th entry in the system. Merges with every other replica are guaranteed to produce an accurate grow only counter. The Github repo containing basic CRDT implementations is <a href="https://github.com/GeorgeRPu/Conflict-Free-Replicated-Data-Types" rel="external nofollow noopener" target="_blank">https://github.com/GeorgeRPu/Conflict-Free-Replicated-Data-Types</a>.</p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">GCounter</span> <span class="p">{</span>
<span class="nl">private:</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">;</span>        <span class="c1">// number of peers</span>
    <span class="kt">int</span> <span class="n">peer_id</span><span class="p">;</span>  <span class="c1">// unique id between 0 and n - 1</span>
    <span class="kt">int</span><span class="o">*</span> <span class="n">inc</span><span class="p">;</span>     <span class="c1">// number of incremements for each peer</span>
<span class="nl">public:</span>
    <span class="n">GCounter</span><span class="p">(</span><span class="kt">int</span> <span class="n">peer_id</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">assert</span><span class="p">(</span><span class="n">peer_id</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">);</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">peer_id</span> <span class="o">=</span> <span class="n">peer_id</span><span class="p">;</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="p">;</span>
        <span class="n">inc</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">increment</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">inc</span><span class="p">[</span><span class="n">peer_id</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">int</span> <span class="nf">value</span><span class="p">()</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">value</span> <span class="o">+=</span> <span class="n">inc</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">merge</span><span class="p">(</span><span class="n">GCounter</span><span class="o">*</span> <span class="n">other</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">inc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">inc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">-&gt;</span><span class="n">inc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">?</span> <span class="n">inc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">:</span> <span class="n">other</span><span class="o">-&gt;</span><span class="n">inc</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div> <p>We can create a <strong>positive-negative counter</strong> out of two grow-only counters. One tracks the number of increments for each peer in the system. The other tracks the number of decrements for each peer in the system. Why can’t we just allow decrements on a grow-only counter? Consider two grow-only counters $A = (0, 0), B = (0, 0)$ in a system containing two machines.</p> <table> <thead> <tr> <th>Order</th> <th>Action</th> <th>A</th> <th>B</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>Peer 1 increments $A$</td> <td>$(1, 0)$</td> <td>$(0, 0)$</td> </tr> <tr> <td>2</td> <td>Peer 2 merges with $B$ with $A$</td> <td>$(1,0)$</td> <td>$(1, 0)$</td> </tr> <tr> <td>3</td> <td>Peer 1 decrements $A$</td> <td>$(0, 0)$</td> <td>$(1, 0)$</td> </tr> </tbody> </table> <p>Now if Peer 2 tries to perform another merger, it will not accept the decrement: $B$ will remain $(1, 0)$. In fact, there is no merger rule that will work, because $A$ could have any value from any number of increments and decrements. One solution might be to trust $A$’s first entry over $B$’s, but now certain replicas have higher status than others. They are unequal.</p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">PNCounter</span> <span class="p">{</span>
<span class="nl">private:</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">;</span>          <span class="c1">// number of peers</span>
    <span class="kt">int</span> <span class="n">peer_id</span><span class="p">;</span>    <span class="c1">// unique id between 0 and n - 1</span>
    <span class="n">GCounter</span><span class="o">*</span> <span class="n">inc</span><span class="p">;</span>  <span class="c1">// increment gcounter</span>
    <span class="n">GCounter</span><span class="o">*</span> <span class="n">dec</span><span class="p">;</span>  <span class="c1">// decrement gcounter</span>
<span class="nl">public:</span>
    <span class="n">PNCounter</span><span class="p">(</span><span class="kt">int</span> <span class="n">peer_id</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">inc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GCounter</span><span class="p">(</span><span class="n">peer_id</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
        <span class="n">dec</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GCounter</span><span class="p">(</span><span class="n">peer_id</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">increment</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">inc</span><span class="o">-&gt;</span><span class="n">increment</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">decrement</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">dec</span><span class="o">-&gt;</span><span class="n">increment</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="kt">int</span> <span class="nf">value</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">inc</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">()</span> <span class="o">-</span> <span class="n">dec</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">merge</span><span class="p">(</span><span class="n">PNCounter</span><span class="o">*</span> <span class="n">other</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">inc</span><span class="o">-&gt;</span><span class="n">merge</span><span class="p">(</span><span class="n">other</span><span class="o">-&gt;</span><span class="n">inc</span><span class="p">);</span>
        <span class="n">dec</span><span class="o">-&gt;</span><span class="n">merge</span><span class="p">(</span><span class="n">other</span><span class="o">-&gt;</span><span class="n">dec</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div> <h3 id="sets">Sets</h3> <p>The most basic collection is a set. Elements are either members or they are not. The simplest set CRDT is the <strong>grow-only set</strong> where only additions are allowed. Replicas are merged by taking the union.</p> \[A = A \cup B\] <p>The union in akin to the $\max$ operation used for the grow only counter. We can order sets by inclusion. That is, $A \leq B$ if and only if $A \subseteq B$. The union is then the smallest set that is greater than $A$ and $B$, just as $\max(a, b)$ is the smallest element that is greater than the two numbers $a$ and $b$. However, because inclusion is a partial order (not every pair of sets are comparable), the union is generally not $A$ or $B$​.</p> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/2020-07-20/partial-total-order-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/2020-07-20/partial-total-order-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/2020-07-20/partial-total-order-1400.webp"></source> <img src="/assets/img/2020-07-20/partial-total-order.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p>Arrows indicate greater than relationships.</p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;unordered_set&gt;</span><span class="c1">;</span><span class="cp">
</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="p">&gt;;</span>
<span class="k">class</span> <span class="nc">GSet</span> <span class="p">{</span>
<span class="nl">private:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">unordered_set</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span> <span class="n">set</span><span class="p">;</span>
<span class="nl">public:</span>
    <span class="n">GSet</span><span class="p">()</span> <span class="p">{}</span>

    <span class="kt">void</span> <span class="nf">add</span><span class="p">(</span><span class="n">T</span> <span class="n">el</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">set</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">el</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">bool</span> <span class="nf">has</span><span class="p">(</span><span class="n">T</span> <span class="n">el</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">set</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="o">!=</span> <span class="n">set</span><span class="p">.</span><span class="n">end</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">merge</span><span class="p">(</span><span class="n">GSet</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span><span class="o">*</span> <span class="n">other</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">T</span> <span class="n">el</span> <span class="o">:</span> <span class="n">other</span><span class="o">-&gt;</span><span class="n">set</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">set</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">el</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div> <p>Like the positive-negative counter, we can construct a full set CRDT from a pair of grow-only sets. One grow-only set $A$ records all the elements added. The other grow-only set $R$ records all the elements removed. If an element $x \in A$ but $x \notin R$ or vice versa, $x$’s membership in the set is clear. If $x \in A$ <em>and</em> $x \in R$, we need a mechanism to break the tie. One option is to resolve the tie is to prefer removals over additions (or additions over removals). If $x \in A$ <em>and</em> $x \in R$, we could say $x$ is not in the set. How $x$ be removed from the set if it was not first made a member? The removal is assumed to have occurred last.</p> <p>We can explicitly determine which operation was last if we record the time each addition/removal took place. For each element in $A$​ or $R$​, we store the timestamp in a hashmap<sup id="fnref:2" role="doc-noteref"><a href="#fn:2" class="footnote" rel="footnote">2</a></sup>. To determine set membership in the case $x \in A, x \in R$​, we check the timestamp of the addition/removal, with the last one winning. For this reason, this CRDT is called a <strong>last write wins set</strong>. To merge the hashmaps, we just use the later timestamp.</p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;chrono&gt;</span><span class="c1">;</span><span class="cp">
#include</span> <span class="cpf">&lt;unordered_map&gt;</span><span class="c1">;</span><span class="cp">
</span>
<span class="k">using</span> <span class="n">time_point</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">time_point</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">system_clock</span><span class="o">&gt;&gt;</span><span class="p">;</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="p">&gt;;</span>
<span class="k">class</span> <span class="nc">LWWSet</span> <span class="p">{</span>
<span class="nl">private:</span>
    <span class="n">GSet</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span><span class="o">*</span> <span class="n">add_set</span><span class="p">;</span>                             <span class="c1">// element additions</span>
    <span class="n">GSet</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span><span class="o">*</span> <span class="n">rm_set</span><span class="p">;</span>                              <span class="c1">// element removals</span>
    <span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">time_point</span><span class="o">&gt;</span><span class="p">;</span> <span class="n">add_times</span><span class="p">;</span>  <span class="c1">// timestamps for element additions</span>
    <span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">time_point</span><span class="o">&gt;</span><span class="p">;</span> <span class="n">rm_times</span><span class="p">;</span>   <span class="c1">// timestamps for element removals</span>
<span class="nl">public:</span>
    <span class="n">LWWSet</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">add_set</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GSet</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;();</span>
        <span class="n">rm_set</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GSet</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;();</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">add</span><span class="p">(</span><span class="n">T</span> <span class="n">el</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">add_set</span><span class="o">-&gt;</span><span class="n">add</span><span class="p">(</span><span class="n">el</span><span class="p">);</span>
        <span class="n">add_times</span><span class="p">[</span><span class="n">el</span><span class="p">]</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">system_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">remove</span><span class="p">(</span><span class="n">T</span> <span class="n">el</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">rm_set</span><span class="o">-&gt;</span><span class="n">add</span><span class="p">(</span><span class="n">el</span><span class="p">);</span>
        <span class="n">rm_times</span><span class="p">[</span><span class="n">el</span><span class="p">]</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">system_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="kt">bool</span> <span class="nf">has</span><span class="p">(</span><span class="n">T</span> <span class="n">el</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">add_set</span><span class="o">-&gt;</span><span class="n">has</span><span class="p">(</span><span class="n">el</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="c1">// add_set must have el</span>
        <span class="p">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rm_set</span><span class="o">-&gt;</span><span class="n">has</span><span class="p">(</span><span class="n">el</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
        <span class="c1">// both add_set and rm_set have el</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// favors removes if timestamps are identical</span>
            <span class="k">return</span> <span class="n">add_times</span><span class="p">[</span><span class="n">el</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">rm_times</span><span class="p">[</span><span class="n">el</span><span class="p">]</span> <span class="o">?</span> <span class="nb">true</span> <span class="o">:</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">merge</span><span class="p">(</span><span class="n">LWWSet</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span><span class="o">*</span> <span class="n">other</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">add_set</span><span class="o">-&gt;</span><span class="n">merge</span><span class="p">(</span><span class="n">other</span><span class="o">-&gt;</span><span class="n">add_set</span><span class="p">);</span>
        <span class="n">rm_set</span><span class="o">-&gt;</span><span class="n">merge</span><span class="p">(</span><span class="n">other</span><span class="o">-&gt;</span><span class="n">rm_set</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">time_point</span><span class="o">&gt;</span><span class="p">;</span> <span class="n">x</span> <span class="o">:</span> <span class="n">other</span><span class="o">-&gt;</span><span class="n">add_times</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">T</span> <span class="n">el</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="n">first</span><span class="p">;</span>
            <span class="n">time_point</span> <span class="n">timestamp</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="n">second</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">add_times</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="o">==</span> <span class="n">add_times</span><span class="p">.</span><span class="n">end</span><span class="p">()</span> <span class="o">||</span> <span class="n">el</span> <span class="o">&gt;</span> <span class="n">add_times</span><span class="p">[</span><span class="n">timestamp</span><span class="p">])</span> <span class="p">{</span>
                <span class="n">add_times</span><span class="p">[</span><span class="n">el</span><span class="p">]</span> <span class="o">=</span> <span class="n">timestamp</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">time_point</span><span class="o">&gt;</span><span class="p">;</span> <span class="n">x</span> <span class="o">:</span> <span class="n">other</span><span class="o">-&gt;</span><span class="n">rm_times</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">T</span> <span class="n">el</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="n">first</span><span class="p">;</span>
            <span class="n">time_point</span> <span class="n">timestamp</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="n">second</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">rm_times</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="o">==</span> <span class="n">rm_times</span><span class="p">.</span><span class="n">end</span><span class="p">()</span> <span class="o">||</span> <span class="n">timestamp</span> <span class="o">&gt;</span> <span class="n">rm_times</span><span class="p">[</span><span class="n">el</span><span class="p">])</span> <span class="p">{</span>
                <span class="n">rm_times</span><span class="p">[</span><span class="n">el</span><span class="p">]</span> <span class="o">=</span> <span class="n">timestamp</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div> <h2 id="building-a-collaborative-text-editor">Building a Collaborative Text Editor</h2> <h3 id="rga">RGA</h3> <p>We can represent text as a variable length sequence of characters. In order to read/write to the text, we need the following operations.</p> <ul> <li> <code class="language-plaintext highlighter-rouge">char get(int i)</code>. Returns the character at position $i$.</li> <li> <code class="language-plaintext highlighter-rouge">void insert(int i, char charachter)</code>. Inserts a character after position $i$.</li> <li> <code class="language-plaintext highlighter-rouge">void remove(int i)</code>. Marks the character at position $i$ as a tombstone (deleted).</li> <li> <code class="language-plaintext highlighter-rouge">void update(int i, char character)</code>. Set the character at position $i$ Note that we could accomplish an update by removing the existing character at position $i$ and inserting the character after position $i - 1$.</li> </ul> <p><strong>Replicated growable array (RGA)</strong> is a CRDT that supports these operations <a class="citation" href="#roh2011replicated">(Roh et al., 2011)</a>. Ironically, it is a linked list of nodes. Each node has an <strong>identifier</strong>, a last update/remove timestamp, a character, and a pointer to the next node. The identifier is the tuple $(insertion_time, inserting_machine_id)$.</p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;chrono&gt;</span><span class="c1">;</span><span class="cp">
#include</span> <span class="cpf">&lt;unordered_map&gt;</span><span class="c1">;</span><span class="cp">
</span>
<span class="k">using</span> <span class="n">time_point</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">time_point</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">system_clock</span><span class="o">&gt;</span><span class="p">;</span>

<span class="k">struct</span> <span class="nc">Node</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">peer_id</span><span class="p">;</span>
    <span class="n">time_point</span> <span class="n">insertion_time</span><span class="p">;</span>
    <span class="n">time_point</span> <span class="n">last_updated_time</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">character</span><span class="p">;</span>
    <span class="n">Node</span><span class="o">*</span> <span class="n">next</span><span class="p">;</span>

    <span class="n">Node</span><span class="p">(</span><span class="kt">int</span> <span class="n">peer_id</span><span class="p">,</span> <span class="kt">char</span> <span class="n">character</span><span class="p">,</span> <span class="n">Node</span><span class="o">*</span> <span class="n">next</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">peer_id</span> <span class="o">=</span> <span class="n">peer_id</span><span class="p">;</span>
        <span class="n">insertion_time</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">system_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
        <span class="n">last_updated_time</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">system_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">character</span> <span class="o">=</span> <span class="n">character</span><span class="p">;</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">next</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div> <p>The get and update operations work identically to their regular linked list counterparts. For convenience, we define a <code class="language-plaintext highlighter-rouge">Node* node_at(int i)</code> method that grabs the $i$th item in the RGA by looping through <code class="language-plaintext highlighter-rouge">next</code> pointers.</p> <ul> <li>We can get character $i$ by returning the character field of the <code class="language-plaintext highlighter-rouge">node_at(i)</code>.</li> <li>We can update a character by setting <code class="language-plaintext highlighter-rouge">node_at(i)-&gt;character</code> to the new character. We also refresh the <code class="language-plaintext highlighter-rouge">last_updated_time</code>.</li> </ul> <p>Instead of actually removing node, we set them to a special, 0 byte, tombstone character. Tombstones will not be included when displaying the RGA.</p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">const</span> <span class="kt">char</span> <span class="n">TOMBSTONE</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">RGA</span> <span class="p">{</span>
<span class="nl">private:</span>
    <span class="kt">int</span> <span class="n">peer_id</span><span class="p">;</span>
    <span class="n">Node</span><span class="o">*</span> <span class="n">head</span><span class="p">;</span>

    <span class="n">Node</span><span class="o">*</span> <span class="n">node_at</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Node</span><span class="o">*</span> <span class="n">node</span> <span class="o">=</span> <span class="n">head</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">counter</span> <span class="o">&lt;</span> <span class="n">i</span><span class="p">;</span> <span class="n">counter</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">node</span><span class="p">;</span>
    <span class="p">}</span>

<span class="k">public</span><span class="o">:</span>
    <span class="n">RGA</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">head</span> <span class="o">=</span> <span class="nb">nullptr</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">char</span> <span class="nf">get</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">node_at</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">character</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">remove</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Node</span><span class="o">*</span> <span class="n">node</span> <span class="o">=</span> <span class="n">node_at</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="n">node</span><span class="o">-&gt;</span><span class="n">c</span> <span class="o">=</span> <span class="n">TOMBSTONE</span><span class="p">;</span>
        <span class="n">node</span><span class="o">-&gt;</span><span class="n">last_updated_time</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">system_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">update</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="kt">char</span> <span class="n">character</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Node</span><span class="o">*</span> <span class="n">node</span> <span class="o">=</span> <span class="n">node_at</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="n">node</span><span class="o">-&gt;</span><span class="n">character</span> <span class="o">=</span> <span class="n">character</span><span class="p">;</span>
        <span class="n">node</span><span class="o">-&gt;</span><span class="n">last_updated_time</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">system_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div> <p>Insertions are different. We cannot always add a new node to the exact right of the <code class="language-plaintext highlighter-rouge">node_at(i)</code> in order to preserve the intentions of other inserts. If we order identifiers lexicographically—by their first item and, in case of a tie, by their second item—then an inserted node with a succeeding identifier must, in general, be inserted later. The intention of the later insert should have higher priority. Hence, we put new node nearer the <code class="language-plaintext highlighter-rouge">node_at(i)</code>.</p> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/2020-07-20/rga-insertion-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/2020-07-20/rga-insertion-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/2020-07-20/rga-insertion-1400.webp"></source> <img src="/assets/img/2020-07-20/rga-insertion.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p>Figure taken from <a class="citation" href="#roh2011replicated">(Roh et al., 2011)</a>. In <a class="citation" href="#roh2011replicated">(Roh et al., 2011)</a>, a hashmap is used to map identifiers to nodes, which we have omitted.</p> <p>It remains to show that this insertion rule is invariant to the order of the insertions, which we do by example. Suppose 3 peers work on a collaborative document. The initial state of RGA is $[n_1, n_5]$ with respective identifiers $i_1 = (0, 2)$ and $i_5 = (2, 1)$. The peers insert a node just after $n_1$ without any intervening merges.</p> <ol> <li>Operation $o_4$: Peer 0 inserts $n_4$, whose identifier is $i_4 = (0, 3)$.</li> <li>Operation $o_3$: Peer 1 inserts $n_3$ with $i_3 = (1, 4)$.</li> <li>Operation $o_2$: Peer 2 inserts $n_2$ with $i_2 = (2, 5)$.</li> </ol> <p>Therefore, $i_2 &lt; i_3 &lt; i_4 &lt; i_5$. The result below shows for each peer a different execution order, which nonetheless reach a convergent state.</p> \[\begin{align*} &amp;[n_1, n_5] \stackrel{o_4}{\longrightarrow} [n_1, n_4, n_5] \stackrel{o_2}{\longrightarrow} [n_1, n_2, n_4, n_5] \stackrel{o_3}{\longrightarrow} [n_1, n_2, n_3, n_4, n_5] \\ &amp;[n_1, n_5] \stackrel{o_3}{\longrightarrow} [n_1, n_3, n_5] \stackrel{o_2}{\longrightarrow} [n_1, n_2, n_3, n_5] \stackrel{o_4}{\longrightarrow} [n_1, n_2, n_3, n_4, n_5] \\ &amp;[n_1, n_5] \stackrel{o_2}{\longrightarrow} [n_1, n_2, n_5] \stackrel{o_3}{\longrightarrow} [n_1, n_2, n_3, n_5] \stackrel{o_4}{\longrightarrow} [n_1, n_2, n_3, n_4, n_5] \end{align*}\] <h3 id="rgasplit">RGASplit</h3> <p>One problem with RGA is that node retrieval can be slow, with a time complexity of $O(n)$. The method <code class="language-plaintext highlighter-rouge">node_at(int i)</code> must loop through $i$ nodes to get the desired node. As our text grows to a considerable size, a collaborative text editor using RGA will slow down. <strong>RGASplit</strong> solves this problem by arranging non-tombstone nodes into a binary tree <a class="citation" href="#briot2016high">(Briot Loı̈ck et al., 2016)</a>. Each node stores an additional weight that counts the number of nodes in its subtree along with obligatory left and right pointers.</p> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/2020-07-20/rgasplit-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/2020-07-20/rgasplit-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/2020-07-20/rgasplit-1400.webp"></source> <img src="/assets/img/2020-07-20/rgasplit.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p>Figure taken from <a class="citation" href="#briot2016high">(Briot Loı̈ck et al., 2016)</a>.</p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;chrono&gt;</span><span class="c1">;</span><span class="cp">
#include</span> <span class="cpf">&lt;unordered_map&gt;</span><span class="c1">;</span><span class="cp">
</span>
<span class="k">using</span> <span class="n">time_point</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">time_point</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">system_clock</span><span class="o">&gt;</span><span class="p">;</span>

<span class="k">struct</span> <span class="nc">Node</span> <span class="p">{</span>
    <span class="c1">// RGA</span>
    <span class="n">time_point</span> <span class="n">insertion_time</span><span class="p">;</span>
    <span class="n">time_point</span> <span class="n">last_updated_time</span><span class="p">;</span>  <span class="c1">// updates or removes</span>
    <span class="kt">char</span> <span class="n">character</span><span class="p">;</span>
    <span class="n">Node</span><span class="o">*</span> <span class="n">next</span><span class="p">;</span>
    <span class="c1">// RGASplit</span>
    <span class="kt">int</span> <span class="n">weight</span><span class="p">;</span>
    <span class="n">Node</span><span class="o">*</span> <span class="n">left</span><span class="p">;</span>
    <span class="n">Node</span><span class="o">*</span> <span class="n">right</span><span class="p">;</span>

    <span class="n">Node</span><span class="p">(</span><span class="kt">char</span> <span class="n">character</span><span class="p">,</span> <span class="n">Node</span><span class="o">*</span> <span class="n">next</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">insertion_time</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">system_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
        <span class="n">last_updated_time</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">system_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">character</span> <span class="o">=</span> <span class="n">character</span><span class="p">;</span>
        <span class="k">this</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">next</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div> <p>The weights are used to navigate the binary tree. Say we want to find the $i$th character in the below binary tree.</p> <ul> <li>The 4th character. We start at the root of the tree and see that the left subtree contains the first 3 characters while the right subtree contains the last 4 characters. Thus, the 4th character is “S”.</li> <li>The 1st character. We start at the root again. It has a left subtree which contains preceding characters. Looking at the “G” node, we notice it too has an active left pointer. Since “R” has no children, it is the first character.</li> <li>The 7th character. Starting from the root, we now go down the right subtree, since $7 &gt; 3 + 1$. Because there are 4 characters outside this subtree, the 7th character in the entire tree is equivalent to the 3rd character in the right subtree. At the “i” node, we see that there is a “p” character on the left and a 2-weight subtree on the right. Finally, we reach the “i” node and see that it is the 7th character.</li> </ul> <div class="jekyll-diagrams diagrams mermaid"> <svg id="mermaid-1696307911276" width="100%" xmlns="http://www.w3.org/2000/svg" style="max-width: 401.30078125px;" viewbox="0 0 401.30078125 318"><style>#mermaid-1696307911276 .label{font-family:trebuchet ms,verdana,arial;color:#333}#mermaid-1696307911276 .node circle,#mermaid-1696307911276 .node ellipse,#mermaid-1696307911276 .node polygon,#mermaid-1696307911276 .node rect{fill:#ececff;stroke:#9370db;stroke-width:1px}#mermaid-1696307911276 .node.clickable{cursor:pointer}#mermaid-1696307911276 .arrowheadPath{fill:#333}#mermaid-1696307911276 .edgePath .path{stroke:#333;stroke-width:1.5px}#mermaid-1696307911276 .edgeLabel{background-color:#e8e8e8}#mermaid-1696307911276 .cluster rect{fill:#ffffde!important;stroke:#aa3!important;stroke-width:1px!important}#mermaid-1696307911276 .cluster text{fill:#333}#mermaid-1696307911276 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:trebuchet ms,verdana,arial;font-size:12px;background:#ffffde;border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1696307911276 .actor{stroke:#ccf;fill:#ececff}#mermaid-1696307911276 text.actor{fill:#000;stroke:none}#mermaid-1696307911276 .actor-line{stroke:grey}#mermaid-1696307911276 .messageLine0{marker-end:"url(#arrowhead)"}#mermaid-1696307911276 .messageLine0,#mermaid-1696307911276 .messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#mermaid-1696307911276 #arrowhead{fill:#333}#mermaid-1696307911276 #crosshead path{fill:#333!important;stroke:#333!important}#mermaid-1696307911276 .messageText{fill:#333;stroke:none}#mermaid-1696307911276 .labelBox{stroke:#ccf;fill:#ececff}#mermaid-1696307911276 .labelText,#mermaid-1696307911276 .loopText{fill:#000;stroke:none}#mermaid-1696307911276 .loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#ccf}#mermaid-1696307911276 .note{stroke:#aa3;fill:#fff5ad}#mermaid-1696307911276 .noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}#mermaid-1696307911276 .section{stroke:none;opacity:.2}#mermaid-1696307911276 .section0{fill:rgba(102,102,255,.49)}#mermaid-1696307911276 .section2{fill:#fff400}#mermaid-1696307911276 .section1,#mermaid-1696307911276 .section3{fill:#fff;opacity:.2}#mermaid-1696307911276 .sectionTitle0,#mermaid-1696307911276 .sectionTitle1,#mermaid-1696307911276 .sectionTitle2,#mermaid-1696307911276 .sectionTitle3{fill:#333}#mermaid-1696307911276 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px}#mermaid-1696307911276 .grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}#mermaid-1696307911276 .grid path{stroke-width:0}#mermaid-1696307911276 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1696307911276 .task{stroke-width:2}#mermaid-1696307911276 .taskText{text-anchor:middle;font-size:11px}#mermaid-1696307911276 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}#mermaid-1696307911276 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1696307911276 .taskText0,#mermaid-1696307911276 .taskText1,#mermaid-1696307911276 .taskText2,#mermaid-1696307911276 .taskText3{fill:#fff}#mermaid-1696307911276 .task0,#mermaid-1696307911276 .task1,#mermaid-1696307911276 .task2,#mermaid-1696307911276 .task3{fill:#8a90dd;stroke:#534fbc}#mermaid-1696307911276 .taskTextOutside0,#mermaid-1696307911276 .taskTextOutside1,#mermaid-1696307911276 .taskTextOutside2,#mermaid-1696307911276 .taskTextOutside3{fill:#000}#mermaid-1696307911276 .active0,#mermaid-1696307911276 .active1,#mermaid-1696307911276 .active2,#mermaid-1696307911276 .active3{fill:#bfc7ff;stroke:#534fbc}#mermaid-1696307911276 .activeText0,#mermaid-1696307911276 .activeText1,#mermaid-1696307911276 .activeText2,#mermaid-1696307911276 .activeText3{fill:#000!important}#mermaid-1696307911276 .done0,#mermaid-1696307911276 .done1,#mermaid-1696307911276 .done2,#mermaid-1696307911276 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1696307911276 .doneText0,#mermaid-1696307911276 .doneText1,#mermaid-1696307911276 .doneText2,#mermaid-1696307911276 .doneText3{fill:#000!important}#mermaid-1696307911276 .crit0,#mermaid-1696307911276 .crit1,#mermaid-1696307911276 .crit2,#mermaid-1696307911276 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1696307911276 .activeCrit0,#mermaid-1696307911276 .activeCrit1,#mermaid-1696307911276 .activeCrit2,#mermaid-1696307911276 .activeCrit3{stroke:#f88;fill:#bfc7ff;stroke-width:2}#mermaid-1696307911276 .doneCrit0,#mermaid-1696307911276 .doneCrit1,#mermaid-1696307911276 .doneCrit2,#mermaid-1696307911276 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1696307911276 .activeCritText0,#mermaid-1696307911276 .activeCritText1,#mermaid-1696307911276 .activeCritText2,#mermaid-1696307911276 .activeCritText3,#mermaid-1696307911276 .doneCritText0,#mermaid-1696307911276 .doneCritText1,#mermaid-1696307911276 .doneCritText2,#mermaid-1696307911276 .doneCritText3{fill:#000!important}#mermaid-1696307911276 .titleText{text-anchor:middle;font-size:18px;fill:#000}
#mermaid-1696307911276 g.classGroup text{fill:#9370db;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}#mermaid-1696307911276 g.classGroup rect{fill:#ececff;stroke:#9370db}#mermaid-1696307911276 g.classGroup line{stroke:#9370db;stroke-width:1}#mermaid-1696307911276 .classLabel .box{stroke:none;stroke-width:0;fill:#ececff;opacity:.5}#mermaid-1696307911276 .classLabel .label{fill:#9370db;font-size:10px}#mermaid-1696307911276 .relation{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1696307911276 #compositionEnd,#mermaid-1696307911276 #compositionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1696307911276 #aggregationEnd,#mermaid-1696307911276 #aggregationStart{fill:#ececff;stroke:#9370db;stroke-width:1}#mermaid-1696307911276 #dependencyEnd,#mermaid-1696307911276 #dependencyStart,#mermaid-1696307911276 #extensionEnd,#mermaid-1696307911276 #extensionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1696307911276 .branch-label,#mermaid-1696307911276 .commit-id,#mermaid-1696307911276 .commit-msg{fill:#d3d3d3;color:#d3d3d3}</style> <style>#mermaid-1696307911276{color:#000;font:normal normal 400 normal 16px / normal "Times New Roman"}</style> <g transform="translate(-12, -12)"><g class="output"><g class="clusters"></g><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M165.6875,50.130973740009786L94.125,83L94.125,108" marker-end="url(#arrowhead22)" style="fill:none"></path><defs><marker id="arrowhead22" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M214.15625,49.85391650099403L288.1640625,83L288.1640625,108" marker-end="url(#arrowhead23)" style="fill:none"></path><defs><marker id="arrowhead23" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M72.77024147727272,146L44.671875,171L44.671875,196" marker-end="url(#arrowhead24)" style="fill:none"></path><defs><marker id="arrowhead24" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M115.47975852272728,146L143.578125,171L143.578125,196" marker-end="url(#arrowhead25)" style="fill:none"></path><defs><marker id="arrowhead25" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M267.865234375,146L241.15625,171L241.15625,196" marker-end="url(#arrowhead26)" style="fill:none"></path><defs><marker id="arrowhead26" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M308.462890625,146L335.171875,171L335.171875,196" marker-end="url(#arrowhead27)" style="fill:none"></path><defs><marker id="arrowhead27" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M314.5846058238636,234L287.49609375,259L287.49609375,284" marker-end="url(#arrowhead28)" style="fill:none"></path><defs><marker id="arrowhead28" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M355.7591441761364,234L382.84765625,259L382.84765625,284" marker-end="url(#arrowhead29)" style="fill:none"></path><defs><marker id="arrowhead29" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" style="opacity: 1;" transform=""><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignobject></g></g><g class="edgeLabel" style="opacity: 1;" transform=""><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignobject></g></g><g class="edgeLabel" style="opacity: 1;" transform=""><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignobject></g></g><g class="edgeLabel" style="opacity: 1;" transform=""><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignobject></g></g><g class="edgeLabel" style="opacity: 1;" transform=""><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignobject></g></g><g class="edgeLabel" style="opacity: 1;" transform=""><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignobject></g></g><g class="edgeLabel" style="opacity: 1;" transform=""><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignobject></g></g><g class="edgeLabel" style="opacity: 1;" transform=""><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignobject></g></g></g><g class="nodes"><g class="node" id="S" transform="translate(189.921875,39)" style="opacity: 1;"><rect rx="0" ry="0" x="-24.234375" y="-19" width="48.46875" height="38"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-14.234375,-9)"><foreignobject width="28.46875" height="18"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">S, 8</div></foreignobject></g></g></g><g class="node" id="G" transform="translate(94.125,127)" style="opacity: 1;"><rect rx="0" ry="0" x="-25.1171875" y="-19" width="50.234375" height="38"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-15.1171875,-9)"><foreignobject width="30.234375" height="18"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">G, 3</div></foreignobject></g></g></g><g class="node" id="l" transform="translate(288.1640625,127)" style="opacity: 1;"><rect rx="0" ry="0" x="-20.671875" y="-19" width="41.34375" height="38"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-10.671875,-9)"><foreignobject width="21.34375" height="18"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">l, 4</div></foreignobject></g></g></g><g class="node" id="R" transform="translate(44.671875,215)" style="opacity: 1;"><rect rx="0" ry="0" x="-24.671875" y="-19" width="49.34375" height="38"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-14.671875,-9)"><foreignobject width="29.34375" height="18"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">R, 1</div></foreignobject></g></g></g><g class="node" id="A" transform="translate(143.578125,215)" style="opacity: 1;"><rect rx="0" ry="0" x="-24.234375" y="-19" width="48.46875" height="38"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-14.234375,-9)"><foreignobject width="28.46875" height="18"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">A, 1</div></foreignobject></g></g></g><g class="node" id="p" transform="translate(241.15625,215)" style="opacity: 1;"><rect rx="0" ry="0" x="-23.34375" y="-19" width="46.6875" height="38"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-13.34375,-9)"><foreignobject width="26.6875" height="18"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">p, 1</div></foreignobject></g></g></g><g class="node" id="i" transform="translate(335.171875,215)" style="opacity: 1;"><rect rx="0" ry="0" x="-20.671875" y="-19" width="41.34375" height="38"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-10.671875,-9)"><foreignobject width="21.34375" height="18"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">i, 2</div></foreignobject></g></g></g><g class="node" id="T" transform="translate(287.49609375,303)" style="opacity: 1;"><rect rx="0" ry="0" x="-22.8984375" y="-19" width="45.796875" height="38"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-12.8984375,-9)"><foreignobject width="25.796875" height="18"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">T, 1</div></foreignobject></g></g></g><g class="node" id="null" transform="translate(382.84765625,303)" style="opacity: 1;"><rect rx="0" ry="0" x="-22.453125" y="-19" width="44.90625" height="38"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-12.453125,-9)"><foreignobject width="24.90625" height="18"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">null</div></foreignobject></g></g></g></g></g></g></svg> </div> <p>To add nodes, RGASplit uses the usual binary tree insertion logic. You move left/right down the tree until you reach a non-branch (one left or right pointer is not <code class="language-plaintext highlighter-rouge">nullptr</code>). To change the capital “T” to a lowercase “t”, we need to delete it and insert the lowercase “t” after “i”. The delete operation navigates the tree using the same logic as above to retrieve the proper node, setting its character to tombstone (shortened to TS). The insert operation first navigates to the location of the “i” node. We know that “t” should be immediately after “i”, since “t” has a later insertion time than the tombstone character. We go to the right and arrive at the tombstone character, where “t” is attached to its left pointer.</p> <div class="jekyll-diagrams diagrams mermaid"> <svg id="mermaid-1696307911798" width="100%" xmlns="http://www.w3.org/2000/svg" style="max-width: 451.1953125px;" viewbox="0 0 451.1953125 406"><style>#mermaid-1696307911798 .label{font-family:trebuchet ms,verdana,arial;color:#333}#mermaid-1696307911798 .node circle,#mermaid-1696307911798 .node ellipse,#mermaid-1696307911798 .node polygon,#mermaid-1696307911798 .node rect{fill:#ececff;stroke:#9370db;stroke-width:1px}#mermaid-1696307911798 .node.clickable{cursor:pointer}#mermaid-1696307911798 .arrowheadPath{fill:#333}#mermaid-1696307911798 .edgePath .path{stroke:#333;stroke-width:1.5px}#mermaid-1696307911798 .edgeLabel{background-color:#e8e8e8}#mermaid-1696307911798 .cluster rect{fill:#ffffde!important;stroke:#aa3!important;stroke-width:1px!important}#mermaid-1696307911798 .cluster text{fill:#333}#mermaid-1696307911798 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:trebuchet ms,verdana,arial;font-size:12px;background:#ffffde;border:1px solid #aa3;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1696307911798 .actor{stroke:#ccf;fill:#ececff}#mermaid-1696307911798 text.actor{fill:#000;stroke:none}#mermaid-1696307911798 .actor-line{stroke:grey}#mermaid-1696307911798 .messageLine0{marker-end:"url(#arrowhead)"}#mermaid-1696307911798 .messageLine0,#mermaid-1696307911798 .messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#mermaid-1696307911798 #arrowhead{fill:#333}#mermaid-1696307911798 #crosshead path{fill:#333!important;stroke:#333!important}#mermaid-1696307911798 .messageText{fill:#333;stroke:none}#mermaid-1696307911798 .labelBox{stroke:#ccf;fill:#ececff}#mermaid-1696307911798 .labelText,#mermaid-1696307911798 .loopText{fill:#000;stroke:none}#mermaid-1696307911798 .loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#ccf}#mermaid-1696307911798 .note{stroke:#aa3;fill:#fff5ad}#mermaid-1696307911798 .noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}#mermaid-1696307911798 .section{stroke:none;opacity:.2}#mermaid-1696307911798 .section0{fill:rgba(102,102,255,.49)}#mermaid-1696307911798 .section2{fill:#fff400}#mermaid-1696307911798 .section1,#mermaid-1696307911798 .section3{fill:#fff;opacity:.2}#mermaid-1696307911798 .sectionTitle0,#mermaid-1696307911798 .sectionTitle1,#mermaid-1696307911798 .sectionTitle2,#mermaid-1696307911798 .sectionTitle3{fill:#333}#mermaid-1696307911798 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px}#mermaid-1696307911798 .grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}#mermaid-1696307911798 .grid path{stroke-width:0}#mermaid-1696307911798 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1696307911798 .task{stroke-width:2}#mermaid-1696307911798 .taskText{text-anchor:middle;font-size:11px}#mermaid-1696307911798 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}#mermaid-1696307911798 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1696307911798 .taskText0,#mermaid-1696307911798 .taskText1,#mermaid-1696307911798 .taskText2,#mermaid-1696307911798 .taskText3{fill:#fff}#mermaid-1696307911798 .task0,#mermaid-1696307911798 .task1,#mermaid-1696307911798 .task2,#mermaid-1696307911798 .task3{fill:#8a90dd;stroke:#534fbc}#mermaid-1696307911798 .taskTextOutside0,#mermaid-1696307911798 .taskTextOutside1,#mermaid-1696307911798 .taskTextOutside2,#mermaid-1696307911798 .taskTextOutside3{fill:#000}#mermaid-1696307911798 .active0,#mermaid-1696307911798 .active1,#mermaid-1696307911798 .active2,#mermaid-1696307911798 .active3{fill:#bfc7ff;stroke:#534fbc}#mermaid-1696307911798 .activeText0,#mermaid-1696307911798 .activeText1,#mermaid-1696307911798 .activeText2,#mermaid-1696307911798 .activeText3{fill:#000!important}#mermaid-1696307911798 .done0,#mermaid-1696307911798 .done1,#mermaid-1696307911798 .done2,#mermaid-1696307911798 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1696307911798 .doneText0,#mermaid-1696307911798 .doneText1,#mermaid-1696307911798 .doneText2,#mermaid-1696307911798 .doneText3{fill:#000!important}#mermaid-1696307911798 .crit0,#mermaid-1696307911798 .crit1,#mermaid-1696307911798 .crit2,#mermaid-1696307911798 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1696307911798 .activeCrit0,#mermaid-1696307911798 .activeCrit1,#mermaid-1696307911798 .activeCrit2,#mermaid-1696307911798 .activeCrit3{stroke:#f88;fill:#bfc7ff;stroke-width:2}#mermaid-1696307911798 .doneCrit0,#mermaid-1696307911798 .doneCrit1,#mermaid-1696307911798 .doneCrit2,#mermaid-1696307911798 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1696307911798 .activeCritText0,#mermaid-1696307911798 .activeCritText1,#mermaid-1696307911798 .activeCritText2,#mermaid-1696307911798 .activeCritText3,#mermaid-1696307911798 .doneCritText0,#mermaid-1696307911798 .doneCritText1,#mermaid-1696307911798 .doneCritText2,#mermaid-1696307911798 .doneCritText3{fill:#000!important}#mermaid-1696307911798 .titleText{text-anchor:middle;font-size:18px;fill:#000}
#mermaid-1696307911798 g.classGroup text{fill:#9370db;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}#mermaid-1696307911798 g.classGroup rect{fill:#ececff;stroke:#9370db}#mermaid-1696307911798 g.classGroup line{stroke:#9370db;stroke-width:1}#mermaid-1696307911798 .classLabel .box{stroke:none;stroke-width:0;fill:#ececff;opacity:.5}#mermaid-1696307911798 .classLabel .label{fill:#9370db;font-size:10px}#mermaid-1696307911798 .relation{stroke:#9370db;stroke-width:1;fill:none}#mermaid-1696307911798 #compositionEnd,#mermaid-1696307911798 #compositionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1696307911798 #aggregationEnd,#mermaid-1696307911798 #aggregationStart{fill:#ececff;stroke:#9370db;stroke-width:1}#mermaid-1696307911798 #dependencyEnd,#mermaid-1696307911798 #dependencyStart,#mermaid-1696307911798 #extensionEnd,#mermaid-1696307911798 #extensionStart{fill:#9370db;stroke:#9370db;stroke-width:1}#mermaid-1696307911798 .branch-label,#mermaid-1696307911798 .commit-id,#mermaid-1696307911798 .commit-msg{fill:#d3d3d3;color:#d3d3d3}</style> <style>#mermaid-1696307911798{color:#000;font:normal normal 400 normal 16px / normal "Times New Roman"}</style> <g transform="translate(-12, -12)"><g class="output"><g class="clusters"></g><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M165.6875,50.130973740009786L94.125,83L94.125,108" marker-end="url(#arrowhead28)" style="fill:none"></path><defs><marker id="arrowhead28" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M214.15625,49.85391650099403L288.1640625,83L288.1640625,108" marker-end="url(#arrowhead29)" style="fill:none"></path><defs><marker id="arrowhead29" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M72.77024147727272,146L44.671875,171L44.671875,196" marker-end="url(#arrowhead30)" style="fill:none"></path><defs><marker id="arrowhead30" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M115.47975852272728,146L143.578125,171L143.578125,196" marker-end="url(#arrowhead31)" style="fill:none"></path><defs><marker id="arrowhead31" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M267.865234375,146L241.15625,171L241.15625,196" marker-end="url(#arrowhead32)" style="fill:none"></path><defs><marker id="arrowhead32" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M308.462890625,146L335.171875,171L335.171875,196" marker-end="url(#arrowhead33)" style="fill:none"></path><defs><marker id="arrowhead33" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M314.5,232.91000692254443L284.38671875,259L284.38671875,284" marker-end="url(#arrowhead34)" style="fill:none"></path><defs><marker id="arrowhead34" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M355.84375,232.91000692254443L385.95703125,259L385.95703125,284" marker-end="url(#arrowhead35)" style="fill:none"></path><defs><marker id="arrowhead35" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M365.75435014204544,322L339.171875,347L339.171875,372" marker-end="url(#arrowhead36)" style="fill:none"></path><defs><marker id="arrowhead36" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M406.15971235795456,322L432.7421875,347L432.7421875,372" marker-end="url(#arrowhead37)" style="fill:none"></path><defs><marker id="arrowhead37" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" style="opacity: 1;" transform=""><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignobject></g></g><g class="edgeLabel" style="opacity: 1;" transform=""><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignobject></g></g><g class="edgeLabel" style="opacity: 1;" transform=""><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignobject></g></g><g class="edgeLabel" style="opacity: 1;" transform=""><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignobject></g></g><g class="edgeLabel" style="opacity: 1;" transform=""><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignobject></g></g><g class="edgeLabel" style="opacity: 1;" transform=""><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignobject></g></g><g class="edgeLabel" style="opacity: 1;" transform=""><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignobject></g></g><g class="edgeLabel" style="opacity: 1;" transform=""><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignobject></g></g><g class="edgeLabel" style="opacity: 1;" transform=""><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignobject></g></g><g class="edgeLabel" style="opacity: 1;" transform=""><g transform="translate(0,0)" class="label"><foreignobject width="0" height="0"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;"><span class="edgeLabel"></span></div></foreignobject></g></g></g><g class="nodes"><g class="node" id="S" transform="translate(189.921875,39)" style="opacity: 1;"><rect rx="0" ry="0" x="-24.234375" y="-19" width="48.46875" height="38"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-14.234375,-9)"><foreignobject width="28.46875" height="18"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">S, 8</div></foreignobject></g></g></g><g class="node" id="G" transform="translate(94.125,127)" style="opacity: 1;"><rect rx="0" ry="0" x="-25.1171875" y="-19" width="50.234375" height="38"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-15.1171875,-9)"><foreignobject width="30.234375" height="18"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">G, 3</div></foreignobject></g></g></g><g class="node" id="l" transform="translate(288.1640625,127)" style="opacity: 1;"><rect rx="0" ry="0" x="-20.671875" y="-19" width="41.34375" height="38"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-10.671875,-9)"><foreignobject width="21.34375" height="18"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">l, 4</div></foreignobject></g></g></g><g class="node" id="R" transform="translate(44.671875,215)" style="opacity: 1;"><rect rx="0" ry="0" x="-24.671875" y="-19" width="49.34375" height="38"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-14.671875,-9)"><foreignobject width="29.34375" height="18"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">R, 1</div></foreignobject></g></g></g><g class="node" id="A" transform="translate(143.578125,215)" style="opacity: 1;"><rect rx="0" ry="0" x="-24.234375" y="-19" width="48.46875" height="38"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-14.234375,-9)"><foreignobject width="28.46875" height="18"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">A, 1</div></foreignobject></g></g></g><g class="node" id="p" transform="translate(241.15625,215)" style="opacity: 1;"><rect rx="0" ry="0" x="-23.34375" y="-19" width="46.6875" height="38"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-13.34375,-9)"><foreignobject width="26.6875" height="18"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">p, 1</div></foreignobject></g></g></g><g class="node" id="i" transform="translate(335.171875,215)" style="opacity: 1;"><rect rx="0" ry="0" x="-20.671875" y="-19" width="41.34375" height="38"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-10.671875,-9)"><foreignobject width="21.34375" height="18"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">i, 2</div></foreignobject></g></g></g><g class="node" id="null" transform="translate(284.38671875,303)" style="opacity: 1;"><rect rx="0" ry="0" x="-22.453125" y="-19" width="44.90625" height="38"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-12.453125,-9)"><foreignobject width="24.90625" height="18"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">null</div></foreignobject></g></g></g><g class="node" id="T" transform="translate(385.95703125,303)" style="opacity: 1;"><rect rx="0" ry="0" x="-29.1171875" y="-19" width="58.234375" height="38"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-19.1171875,-9)"><foreignobject width="38.234375" height="18"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">TS, 1</div></foreignobject></g></g></g><g class="node" id="t" transform="translate(339.171875,391)" style="opacity: 1;"><rect rx="0" ry="0" x="-21.1171875" y="-19" width="42.234375" height="38"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-11.1171875,-9)"><foreignobject width="22.234375" height="18"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">t, 1</div></foreignobject></g></g></g><g class="node" id="null2" transform="translate(432.7421875,391)" style="opacity: 1;"><rect rx="0" ry="0" x="-22.453125" y="-19" width="44.90625" height="38"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-12.453125,-9)"><foreignobject width="24.90625" height="18"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; white-space: nowrap;">null</div></foreignobject></g></g></g></g></g></g></svg> </div> <p>Note that there are multiple binary trees that could represent the same ordering of objects. RGASplit treats these similarly, allowing each peer to self-balance its binary tree as it sees fit.</p> <h2 id="beyond-shared-documents">Beyond Shared Documents</h2> <p>CRDTs are a young invention. WOOT—”the first CRDT algorithm proposed for group editing”—was published in 2006. The first CRDTs were a reaction to an older technology <strong>operation transform</strong> (OT). OT would transform successive operations to be compatible with preceding operations. Many OT algorithms turned out to be incorrect. One of the few that was—and ended up powering Google Docs—required all traffic go through a central server. And while their origins might revolve around collaborative editing a la Google Docs, their future does not have to be. CRDTs allow for decentralized versions of many web-apps, but CRDTs could be used in multithreaded programs to maximize usage of multiple cores. This was how CRDTs would be used in X-ray, allowing multiple extensions to tamper with the text simultaneously without fear of inconsistency.</p> <iframe style="iframe { aspect-ratio: 560/315; height: auto; width: 100%; }" height="315" width="550" src="https://www.youtube.com/embed/x7drE24geUw" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe> <p>CRDTs are seeing increasing use in a variety of <a href="https://crdt.tech/implementations" rel="external nofollow noopener" target="_blank">very popular applications</a>. Engineers are improving available open source implementations, making them smaller and faster. Researchers are working on expanding the scope of CRDTs, such as to all JSON objects <a class="citation" href="#kleppmann2017conflict">(Kleppmann &amp; Beresford, 2017)</a>. CRDTs are getting better and better. I do not think this will stop anytime soon.</p> <h2 id="references">References</h2> <ol class="bibliography"> <li><span id="roh2011replicated">Roh, H.-G., Jeon, M., Kim, J.-S., &amp; Lee, J. (2011). Replicated abstract data types: Building blocks for collaborative applications. <i>Journal of Parallel and Distributed Computing</i>, <i>71</i>(3), 354–368. http://csl.skku.edu/papers/jpdc11.pdf</span></li> <li><span id="briot2016high">Briot Loı̈ck, Urso, P., &amp; Shapiro, M. (2016). High responsiveness for group editing crdts. <i>Proceedings of the 19th International Conference on Supporting Group Work</i>, 51–60. https://lip6.fr/Marc.Shapiro/papers/rgasplit-group2016-11.pdf</span></li> <li><span id="kleppmann2017conflict">Kleppmann, M., &amp; Beresford, A. R. (2017). A conflict-free replicated JSON datatype. <i>IEEE Transactions on Parallel and Distributed Systems</i>, <i>28</i>(10), 2733–2746. https://ieeexplore.ieee.org/abstract/document/7909007</span></li> </ol> <hr> <div class="footnotes" role="doc-endnotes"> <ol> <li id="fn:1" role="doc-endnote"> <p>Electron was originally named <a href="https://www.electronjs.org/blog/electron" rel="external nofollow noopener" target="_blank">Atom Shell</a> because it was built for the Atom editor. Because the electrons orbiting atoms in pictures form a kind of shell, Electron was chosen as the new name. <a href="#fnref:1" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:2" role="doc-endnote"> <p>In a distributed system, there may not be an agreed upon time. That is, multiple computers’ clocks give different times. In this case, the sum of the <a href="https://en.wikipedia.org/wiki/Vector_clock" rel="external nofollow noopener" target="_blank">vector clock</a> can be used. A vector clock tracks the time of each machine in the system, updated by regular time messages. However, most modern computers can get an accurate time with millisecond level precision, so long as they’re connected to the Internet to receive regular synchronization messages. <a href="#fnref:2" class="reversefootnote" role="doc-backlink">↩</a></p> </li> </ol> </div> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2021/bittorrent-client/">Implementing a BitTorrent-like P2P File Sharing Protocol</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2021/floc/">Federated Learning of Cohorts</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/books/">2022 in Books</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2021/research-code/">Writing Code for (Machine Learning) Research</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/economic-possiblities-for-ourselves/">Economic Possibilities for Ourselves</a> </li> <div id="giscus_thread" style="max-width: 800px; margin: 0 auto;"> <script>let giscusTheme=localStorage.getItem("theme"),giscusAttributes={src:"https://giscus.app/client.js","data-repo":"GeorgeRPu/georgerpu.github.io","data-repo-id":"MDEwOlJlcG9zaXRvcnk2MDAyNDM2NQ==","data-category":"Comments","data-category-id":"DIC_kwDOA5PmLc4CTBt6","data-mapping":"title","data-strict":"1","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":giscusTheme,"data-lang":"en",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([t,e])=>giscusScript.setAttribute(t,e)),document.getElementById("giscus_thread").appendChild(giscusScript);</script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> </div> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2023 George Pu. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="/assets/js/bootstrap-toc.min.js?c82ff4de8b0955d6ff14f5b05eed7eb6"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@4.0.0-beta.3/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>